@page "{handler?}"


@model CurrencyApp.Pages.ItemsModel
@{
    ViewData["Title"] = "Lista przedmiotów";
}
@Html.AntiForgeryToken()

<div class="row flex-row">
    @* Left Form *@
    <div class="col-md-3 pb-1">
        @await Html.PartialAsync("~/Pages/ItemsPartials/_CheckBoxesItPartial.cshtml", Model)
    </div>

    @* Center table *@
    <div class="container col-md-9 col-sm-12">
        <form method="post">
        </form>
        @await Html.PartialAsync("~/Pages/ItemsPartials/_ItemTablePartial.cshtml", Model)

        @* For adding an item *@
    </div>
</div>



@section scripts{
    <script src="~/lib/jqueryui/jquery-ui.js"></script>
    <script src="~/js/itemTableScript.js"></script>
    <script>
        $(function () {
            $.ajax({
                url: "/Items/ReturnJson",
                type: "POST",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("XSRF-TOKEN", $('input:hidden[name="__RequestVerificationToken"]').val());
                }
            }).done(function (result) {
                var stringText = result;
                window.localStorage.setItem("ItemsStorage", stringText);
            });

            $.ajax({
                url: "/Items/ReturnJson",
                type: "POST",
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("XSRF-TOKEN", $('input:hidden[name="__RequestVerificationToken"]').val());
                }
            }).done(function (result) {
                var stringText = result;
                window.localStorage.setItem("ItemsStorage", stringText);
            });


            $("#sortable").sortable({
                items: "tr",
                placeholder: "table-active"
                //update: function (event, ui) {
                //    var ids = $("#sortable").sortable("serialize");
                //    ids = ids.replace("item[]=", "").split("&item[]=").map(x => parseInt(x));
                //    var url = "/Items/ChangePos";
                //    $.ajax({
                //        url: url,
                //        type: "POST",
                //        data: { ids: ids },
                //        beforeSend: function (xhr) {
                //            xhr.setRequestHeader("XSRF-TOKEN", $('input:hidden[name="__RequestVerificationToken"]').val());
                //        }
                //    }).done(function (result) {

                //    });
            });
        });
    </script>

}
@section styles{
    <link href="~/lib/jqueryui/jquery-ui.css" rel="stylesheet" />
}
